<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiClick - Software E-commerce</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons CDN (Vanilla JS version) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-primary': '#1a1a1a',
                        'brand-secondary': '#f3f3f3',
                        'brand-accent': '#4a90e2',
                        'brand-accent-hover': '#357abd',
                    }
                }
            }
        }
    </script>
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; background-color: #ffffff; }
        i[data-lucide] { width: 24px; height: 24px; }
        .search-bar-container { transition: all 0.3s ease-in-out; }
        .modal-overlay { transition: opacity 0.3s ease-in-out; }
        .active-category { box-shadow: 0 0 0 3px #4a90e2; }
        .selected-option { border: 2px solid #4a90e2; box-shadow: 0 0 0 1px #4a90e2; }
    </style>
</head>
<body class="bg-white text-brand-primary">

    <!-- Announcement Bar -->
    <div id="promotion-bar" class="bg-brand-primary text-white text-center py-2.5 text-sm font-medium">
        Loading...
    </div>

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-40">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between h-20 relative">
                <a href="#" class="text-2xl font-bold tracking-tight z-10">Digi Click</a>
                <nav class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="text-gray-600 hover:text-brand-accent transition-colors duration-300 font-medium">Home</a>
                    <a href="#shop" class="text-gray-600 hover:text-brand-accent transition-colors duration-300 font-medium">Shop</a>
                    <a href="#about" class="text-gray-600 hover:text-brand-accent transition-colors duration-300 font-medium">About Us</a>
                    <a href="./chatbot.html" class="text-gray-600 hover:text-brand-accent transition-colors duration-300 font-medium">Chat Bot</a>
                    <a href="./contect.html" class="text-gray-600 hover:text-brand-accent transition-colors duration-300 font-medium">Contact</a>
                </nav>
                <div id="search-bar-container" class="search-bar-container absolute right-0 flex items-center justify-end w-full h-full bg-white opacity-0 pointer-events-none -z-10">
                    <input type="text" id="search-input" placeholder="Search for products..." class="w-full max-w-sm px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-accent">
                    <button id="close-search-btn" class="ml-2 text-gray-500 hover:text-brand-primary"><i data-lucide="x"></i></button>
                </div>
                <div id="header-icons" class="flex items-center space-x-5 z-10">
                    <button id="search-btn" class="text-gray-500 hover:text-brand-accent"><i data-lucide="search"></i></button>
                    <button id="user-btn" class="text-gray-500 hover:text-brand-accent"><i data-lucide="user"></i></button>
                    <button id="mobile-menu-button" class="md:hidden text-gray-500 hover:text-brand-accent"><i data-lucide="menu"></i></button>
                </div>
            </div>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <nav class="flex flex-col p-4 space-y-4">
                <a href="#home" class="text-gray-600 hover:text-brand-accent">Home</a>
                <a href="#shop" class="text-gray-600 hover:text-brand-accent">Shop</a>
                <a href="#about" class="text-gray-600 hover:text-brand-accent">About Us</a>
                <a href="./chatbot.html" class="text-gray-600 hover:text-brand-accent">Chat Bot</a>
                <a href="./contect.html" class="text-gray-600 hover:text-brand-accent">Contact</a>
            </nav>
        </div>
    </header>

    <main id="home">
        <!-- Hero Section -->
        <section id="hero-section" class="relative h-[60vh] md:h-[80vh] bg-cover bg-center text-white bg-gray-300">
            <div class="absolute inset-0 bg-black bg-opacity-40"></div>
            <div class="relative z-10 flex flex-col items-center justify-center h-full text-center px-4">
                <h1 id="hero-title" class="text-4xl md:text-6xl lg:text-7xl font-extrabold mb-4 leading-tight">Loading...</h1>
                <p id="hero-subtitle" class="text-lg md:text-xl max-w-2xl mb-8">Please wait while we fetch the latest styles.</p>
                <a href="#shop" class="bg-brand-accent hover:bg-brand-accent-hover text-white font-bold py-3 px-8 rounded-lg text-lg transition-transform transform hover:scale-105 duration-300">Shop Now</a>
            </div>
        </section>

        <!-- Featured Categories -->
        <section id="shop" class="py-16 md:py-24 bg-brand-secondary">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-12">Shop by Category</h2>
                <div id="category-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4 md:gap-8"><p class="col-span-full text-center">Loading categories...</p></div>
            </div>
        </section>

        <!-- Best Sellers -->
        <section id="new-arrivals" class="py-16 md:py-24 bg-white">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-12">Our Best Sellers</h2>
                <div id="product-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-8"><p class="col-span-full text-center">Loading products...</p></div>
            </div>
        </section>

        <!-- Sale Banner -->
        <section class="bg-brand-primary text-white">
            <div class="container mx-auto px-4 py-16 text-center">
                <h2 class="text-3xl md:text-4xl font-bold mb-2">LIMITED TIME OFFERS!</h2>
                <p class="text-lg md:text-xl mb-6">Exclusive discounts on premium software. Don't miss out!</p>
                <a href="#shop" class="bg-white text-brand-primary font-bold py-3 px-8 rounded-lg text-lg hover:bg-gray-200 transition-colors duration-300">Explore Deals</a>
            </div>
        </section>

        <!-- Testimonials -->
        <section id="about" class="py-16 md:py-24 bg-brand-secondary">
            <div class="container mx-auto px-4">
                <h2 class="text-3xl font-bold text-center mb-12">What Our Customers Say</h2>
                <div id="testimonial-grid" class="grid grid-cols-1 md:grid-cols-3 gap-8"><p class="col-span-full text-center">Loading testimonials...</p></div>
            </div>
        </section>
        
        <!-- Newsletter Subscription -->
        <section id="contact" class="py-16 bg-white">
            <div class="container mx-auto px-4">
                <div class="max-w-2xl mx-auto text-center">
                    <h2 class="text-3xl font-bold mb-4">Join Our Newsletter</h2>
                    <p class="text-gray-600 mb-8">Subscribe to get the latest on sales, new releases and more.</p>
                    <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4">
                        <input type="email" id="newsletter-email" placeholder="Enter your email" class="flex-grow w-full px-4 py-3 rounded-md border border-gray-300 focus:outline-none focus:ring-2 focus:ring-brand-accent" required>
                        <button type="submit" class="bg-brand-primary text-white font-bold py-3 px-8 rounded-md hover:bg-gray-800 transition-colors duration-300">Subscribe</button>
                    </form>
                    <p id="newsletter-feedback" class="mt-4 text-green-600"></p>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-brand-primary text-white">
        <div class="container mx-auto px-4 py-16">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div><h3 class="text-xl font-bold mb-4">Digi Click</h3><p class="text-gray-400">Your destination for modern, stylish, and high-quality software solutions.</p></div>
                <div><h3 class="text-lg font-semibold mb-4">Shop</h3><ul class="space-y-3"><li><a href="#new-arrivals" class="text-gray-400 hover:text-white">New Arrivals</a></li><li><a href="#shop" class="text-gray-400 hover:text-white">Best Sellers</a></li></ul></div>
                <div><h3 class="text-lg font-semibold mb-4">Customer Service</h3><ul class="space-y-3"><li><a href="#contact" class="text-gray-400 hover:text-white">Contact Us</a></li><li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li></ul></div>
                <div><h3 class="text-lg font-semibold mb-4">Follow Us</h3><div class="flex space-x-4"><a href="#" class="text-gray-400 hover:text-white"><i data-lucide="facebook"></i></a><a href="#" class="text-gray-400 hover:text-white"><i data-lucide="instagram"></i></a><a href="#" class="text-gray-400 hover:text-white"><i data-lucide="twitter"></i></a></div></div>
            </div>
            <div class="border-t border-gray-700 mt-12 pt-8 text-center text-gray-500"><p>Â© 2024 Digi Click. All Rights Reserved.</p></div>
        </div>
    </footer>

    <!-- User Profile Modal -->
    <div id="user-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full">
            <div class="flex justify-between items-center mb-6"><h2 id="user-modal-title" class="text-2xl font-bold">My Account</h2><button id="close-user-modal-btn" class="text-gray-500 hover:text-brand-primary"><i data-lucide="x"></i></button></div>
            <div id="auth-view">
                <form id="user-form">
                    <div class="mb-4"><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="email" class="w-full px-3 py-2 border rounded-md" placeholder="you@example.com" required></div>
                    <div class="mb-4"><label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label><input type="password" id="password" class="w-full px-3 py-2 border rounded-md" placeholder="â¢â¢â¢â¢â¢â¢â¢â¢" required></div>
                    <div id="confirm-password-container" class="mb-6 hidden"><label for="confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label><input type="password" id="confirm-password" class="w-full px-3 py-2 border rounded-md" placeholder="â¢â¢â¢â¢â¢â¢â¢â¢"></div>
                    <p id="user-form-feedback" class="mb-4 text-sm text-center"></p>
                    <button id="user-form-submit" type="submit" class="w-full bg-brand-primary text-white font-bold py-3 rounded-md hover:bg-gray-800">Sign In</button>
                    <p id="user-form-toggle" class="text-center text-sm text-gray-600 mt-4">Don't have an account? <a href="#" class="font-medium text-brand-accent hover:underline">Sign up</a></p>
                </form>
            </div>
            <div id="signed-in-view" class="hidden"><p id="user-email-display" class="mb-4 text-center"></p><button id="sign-out-btn" class="w-full bg-red-500 text-white font-bold py-3 rounded-md hover:bg-red-600">Sign Out</button></div>
        </div>
    </div>
    
    <!-- Quick View Modal -->
    <div id="quick-view-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none">
        <div class="bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full flex flex-col md:flex-row gap-8 relative">
            <button id="close-quick-view-btn" class="absolute top-4 right-4 text-gray-500 hover:text-brand-primary"><i data-lucide="x"></i></button>
            <div class="md:w-1/2"><img id="quick-view-image" src="https://placehold.co/400x500/fecaca/333333?text=Product" alt="Product Image" class="w-full h-auto rounded-lg"></div>
            <div class="md:w-1/2 flex flex-col justify-between">
                <div>
                    <h2 id="quick-view-name" class="text-3xl font-bold mb-2">Product Name</h2>
                    <p id="quick-view-price" class="text-2xl font-bold text-brand-accent mb-4">â¹0</p>
                    <p id="quick-view-description" class="text-gray-600 mb-6">A brief description of the product.</p>
                    <div id="quick-view-variants" class="mb-6"><h3 class="font-semibold text-lg mb-2">Select Variant:</h3><div class="flex flex-wrap gap-2" id="variant-options"></div></div>
                </div>
                <button id="quick-view-buy-now-btn" class="w-full bg-brand-accent text-white font-bold py-3 rounded-lg hover:bg-brand-accent-hover">Buy Now</button>
            </div>
        </div>
    </div>

    <!-- Payment & Thank You Modals -->
    <div id="payment-processing-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 hidden"><div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center"><i data-lucide="credit-card" class="w-16 h-16 text-brand-accent mx-auto mb-4 animate-pulse"></i><h2 class="text-2xl font-bold mb-2">Redirecting...</h2><p class="text-gray-600">Please wait while we prepare your secure payment link.</p></div></div>
    <div id="thank-you-overlay" class="fixed inset-0 bg-black bg-opacity-70 z-50 flex items-center justify-center p-4 hidden"><div class="bg-white rounded-lg shadow-xl p-8 max-w-sm w-full text-center"><i data-lucide="check-circle" class="w-16 h-16 text-green-500 mx-auto mb-4"></i><h2 class="text-2xl font-bold mb-2">Payment Processing...</h2><p class="text-gray-600">You will be redirected shortly.</p></div></div>

    <script type="module">
        // --- Firebase Integration ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBgErP_g_ZqKraxqFAQi3W0YdwwkQdAZzg",
            authDomain: "my-chat-app-a9b9e.firebaseapp.com",
            projectId: "my-chat-app-a9b9e",
            storageBucket: "my-chat-app-a9b9e.appspot.com",
            messagingSenderId: "292137527608",
            appId: "1:292137527608:web:692b165effa77e79bf79cd"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const productsCollection = collection(db, 'products');
        const categoriesCollection = collection(db, 'categories');
        const testimonialsCollection = collection(db, 'testimonials');
        const siteContentDocRef = doc(db, 'siteContent', 'homepage');

        // --- Global State ---
        let allProducts = [];
        let currentCategory = 'All';
        let selectedProduct = null;
        let selectedVariant = null;

        // --- UI Elements ---
        const productGrid = document.getElementById('product-grid');
        const categoryGrid = document.getElementById('category-grid');
        const testimonialGrid = document.getElementById('testimonial-grid');
        const heroTitle = document.getElementById('hero-title');
        const heroSubtitle = document.getElementById('hero-subtitle');
        const heroSection = document.getElementById('hero-section');
        const promotionBar = document.getElementById('promotion-bar');
        const quickViewModal = document.getElementById('quick-view-modal');

        // --- Data Rendering ---
        function renderProducts(productsToRender) {
            productGrid.innerHTML = productsToRender.length ? productsToRender.map(p => {
                const tagColor = p.tag?.toLowerCase() === 'sale' ? 'bg-red-500' : p.tag?.toLowerCase() === 'new' ? 'bg-green-500' : 'bg-blue-500';
                return `
                <div class="product-card group bg-white rounded-lg overflow-hidden border border-gray-200 hover:shadow-lg transition-shadow duration-300 cursor-pointer" data-product-id="${p.id}">
                    <div class="relative overflow-hidden aspect-video">
                        <img src="${p.image}" alt="${p.name}" class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105" onerror="this.onerror=null;this.src='https://placehold.co/400x225/f3f3f3/999999?text=Image+Error';">
                        ${p.tag ? `<div class="absolute top-2 left-2 ${tagColor} text-white text-xs font-bold px-2.5 py-1 rounded">${p.tag.toUpperCase()}</div>` : ''}
                    </div>
                    <div class="p-4 text-center bg-white">
                        <h3 class="product-name text-md font-semibold text-gray-900 capitalize mb-1 truncate" title="${p.name}">${p.name}</h3>
                        <p class="text-sm text-blue-600 font-semibold">Starts from â¹${p.variants[0].price.toLocaleString('en-IN')}</p>
                    </div>
                </div>
            `}).join('') : '<p class="col-span-full text-center text-gray-600">No products found.</p>';
        }
        
        function renderCategories(categoriesData) {
            let html = `<button data-category="All" class="category-btn group relative overflow-hidden rounded-lg active-category aspect-video"><div class="absolute inset-0 bg-brand-primary flex items-center justify-center"><h3 class="text-white text-xl font-bold">All</h3></div></button>`;
            html += categoriesData.map(c => `
                <button data-category="${c.name}" class="category-btn group relative overflow-hidden rounded-lg aspect-video">
                    <img src="${c.image}" alt="${c.name}" class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110" onerror="this.onerror=null;this.src='https://placehold.co/300x200/cccccc/333333?text=${c.name}';">
                    <div class="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center p-2"><h3 class="text-white text-xl font-bold text-center">${c.name}</h3></div>
                </button>`).join('');
            categoryGrid.innerHTML = html;
        }
        
        function renderTestimonials(testimonials) {
            testimonialGrid.innerHTML = testimonials.length ? testimonials.map(t => `
                <div class="bg-white p-8 rounded-lg shadow-md text-center">
                    <img src="${t.image}" class="w-20 h-20 rounded-full mx-auto mb-4" alt="${t.name}" onerror="this.onerror=null;this.src='https://placehold.co/100x100/cccccc/333333?text=User';">
                    <p class="text-gray-600 mb-4">"${t.text}"</p><h4 class="font-bold text-lg">${t.name}</h4><p class="text-sm text-gray-500">${t.location}</p>
                </div>`).join('') : '<p class="col-span-full text-center">No testimonials yet.</p>';
        }

        function renderSiteContent(data) {
            heroTitle.textContent = data.heroTitle || 'Welcome to DigiClick';
            heroSubtitle.textContent = data.heroSubtitle || 'Your one-stop shop for software.';
            heroSection.style.backgroundImage = `url('${data.heroBackgroundImage || ''}')`;
            promotionBar.textContent = data.promotionText || 'Check out our latest deals!';
        }

        // --- Purchase & Modal Logic ---
        async function handleBuyNow() {
            if (!selectedProduct || !selectedVariant) return;
            if (!selectedVariant.paymentLink) { alert("No payment link configured."); return; }
            try {
                const paymentWindow = window.open(selectedVariant.paymentLink, '_blank');
                if (!paymentWindow) alert("Pop-up blocked. Please allow pop-ups.");
            } catch (e) { alert("Error opening payment window."); }
            const paymentProcessingOverlay = document.getElementById('payment-processing-overlay');
            paymentProcessingOverlay.classList.remove('hidden');
            closeQuickViewModal();
            await new Promise(resolve => setTimeout(resolve, 3000));
            paymentProcessingOverlay.classList.add('hidden');
            const thankYouOverlay = document.getElementById('thank-you-overlay');
            thankYouOverlay.classList.remove('hidden');
            setTimeout(() => thankYouOverlay.classList.add('hidden'), 3000);
        }

        function openQuickViewModal(productId) {
            selectedProduct = allProducts.find(p => p.id === productId);
            if (!selectedProduct) return;
            document.getElementById('quick-view-image').src = selectedProduct.image;
            document.getElementById('quick-view-name').textContent = selectedProduct.name;
            document.getElementById('quick-view-description').textContent = selectedProduct.description;
            const variantOptionsContainer = document.getElementById('variant-options');
            variantOptionsContainer.innerHTML = '';
            selectedVariant = null;
            document.getElementById('quick-view-buy-now-btn').disabled = true;
            if (selectedProduct.variants?.length) {
                selectedProduct.variants.forEach((variant, index) => {
                    const btn = document.createElement('button');
                    btn.className = `px-4 py-2 border rounded-md hover:border-brand-accent text-sm`;
                    btn.textContent = variant.name;
                    btn.addEventListener('click', () => {
                        variantOptionsContainer.querySelectorAll('button').forEach(b => b.classList.remove('selected-option'));
                        btn.classList.add('selected-option');
                        selectedVariant = selectedProduct.variants[index];
                        document.getElementById('quick-view-price').textContent = `â¹${selectedVariant.price.toLocaleString('en-IN')}`;
                        document.getElementById('quick-view-buy-now-btn').disabled = false;
                    });
                    variantOptionsContainer.appendChild(btn);
                });
                variantOptionsContainer.querySelector('button').click();
            }
            quickViewModal.classList.remove('opacity-0', 'pointer-events-none');
        }

        function closeQuickViewModal() { quickViewModal.classList.add('opacity-0', 'pointer-events-none'); }

        // --- DOM Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();

            // Fetch dynamic content from Firestore
            onSnapshot(productsCollection, snap => { allProducts = snap.docs.map(d => ({ id: d.id, ...d.data() })); renderProducts(allProducts); });
            onSnapshot(categoriesCollection, snap => renderCategories(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
            onSnapshot(testimonialsCollection, snap => renderTestimonials(snap.docs.map(d => ({ id: d.id, ...d.data() }))));
            onSnapshot(siteContentDocRef, doc => { if (doc.exists()) renderSiteContent(doc.data()); });

            // General UI event listeners
            document.getElementById('mobile-menu-button').addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
            document.getElementById('search-btn').addEventListener('click', () => document.getElementById('search-bar-container').classList.remove('opacity-0', 'pointer-events-none', '-z-10'));
            document.getElementById('close-search-btn').addEventListener('click', () => document.getElementById('search-bar-container').classList.add('opacity-0', 'pointer-events-none', '-z-10'));
            document.getElementById('search-input').addEventListener('keyup', (e) => renderProducts(allProducts.filter(p => p.name.toLowerCase().includes(e.target.value.toLowerCase()))));
            
            productGrid.addEventListener('click', e => {
                const card = e.target.closest('.product-card');
                if (card) {
                    openQuickViewModal(card.dataset.productId);
                }
            });

            categoryGrid.addEventListener('click', e => {
                const btn = e.target.closest('.category-btn');
                if (btn) {
                    currentCategory = btn.dataset.category;
                    renderProducts(currentCategory === 'All' ? allProducts : allProducts.filter(p => p.category === currentCategory));
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active-category'));
                    btn.classList.add('active-category');
                }
            });

            // Modal event listeners
            document.getElementById('user-btn').addEventListener('click', () => document.getElementById('user-modal').classList.remove('opacity-0', 'pointer-events-none'));
            document.getElementById('close-user-modal-btn').addEventListener('click', () => document.getElementById('user-modal').classList.add('opacity-0', 'pointer-events-none'));
            document.getElementById('close-quick-view-btn').addEventListener('click', closeQuickViewModal);
            document.getElementById('quick-view-buy-now-btn').addEventListener('click', handleBuyNow);
            
            // Firebase Auth UI
            const userForm = document.getElementById('user-form');
            let isSignUp = false;
            onAuthStateChanged(auth, user => {
                document.getElementById('auth-view').classList.toggle('hidden', !!user);
                document.getElementById('signed-in-view').classList.toggle('hidden', !user);
                if (user) document.getElementById('user-email-display').textContent = `Signed in as ${user.email}`;
            });
            document.getElementById('sign-out-btn').addEventListener('click', () => signOut(auth));
            document.getElementById('user-form-toggle').addEventListener('click', e => {
                e.preventDefault(); isSignUp = !isSignUp;
                document.getElementById('user-modal-title').textContent = isSignUp ? 'Create Account' : 'My Account';
                document.getElementById('user-form-submit').textContent = isSignUp ? 'Sign Up' : 'Sign In';
                document.getElementById('confirm-password-container').classList.toggle('hidden', !isSignUp);
            });
            userForm.addEventListener('submit', e => {
                e.preventDefault();
                const email = userForm.email.value, password = userForm.password.value;
                const feedbackEl = document.getElementById('user-form-feedback');
                const authFn = isSignUp ? createUserWithEmailAndPassword : signInWithEmailAndPassword;
                authFn(auth, email, password)
                    .then(() => { feedbackEl.textContent = 'Success!'; setTimeout(() => document.getElementById('user-modal').classList.add('opacity-0', 'pointer-events-none'), 1500); })
                    .catch(err => { feedbackEl.textContent = err.message; });
            });
        });
    </script>
</body>
</html>
